
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.6">
    
    
      
        <title>Arduino - Wind Farm Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#arduino" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Wind Farm Documentation" class="md-header__button md-logo" aria-label="Wind Farm Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Wind Farm Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Arduino
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Wind Farm Documentation" class="md-nav__button md-logo" aria-label="Wind Farm Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Wind Farm Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Wind Farm Project
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../esp-01/getting-started/" class="md-nav__link">
        Getting started with ESP01
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Dataproducer 01
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Dataproducer 01" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Dataproducer 01
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dataproducer-1/dataproducer-1/" class="md-nav__link">
        Dataproducer 1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dataproducer-1/dht11/" class="md-nav__link">
        Humidity Sensor DH11
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dataproducer-1/graphical-lcd-backpack/" class="md-nav__link">
        Graphical LCD Backpack
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Dataproducer 02
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Dataproducer 02" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Dataproducer 02
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dataproducer-2/dataproducer-2/" class="md-nav__link">
        Data producer 2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dataproducer-2/accelerometer/" class="md-nav__link">
        Accelerometer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dataproducer-2/liquidcrystali2c/" class="md-nav__link">
        Liquid Crystal Display connected with i2c bus
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          MQTT
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="MQTT" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          MQTT
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mqtt/broker/" class="md-nav__link">
        Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mqtt/mqtt/" class="md-nav__link">
        MQTT Broker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mqtt/mcp/" class="md-nav__link">
        MCP23027
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Supervision Station
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Supervision Station" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Supervision Station
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Supervision-Station/" class="md-nav__link">
        Supervision
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../chibios/" class="md-nav__link">
        ChibiOS
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Arduino
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Arduino
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#i2c-protocol-for-rpi-b-connection" class="md-nav__link">
    I2C Protocol for RPi B connection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp01-connection" class="md-nav__link">
    ESP01 connection
  </a>
  
    <nav class="md-nav" aria-label="ESP01 connection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-arduino-code" class="md-nav__link">
    The arduino code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#merge-of-both-codes-for-arduino-mega" class="md-nav__link">
    Merge of both codes for Arduino Mega
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#merge-of-both-codes-for-arduino-uno" class="md-nav__link">
    Merge of both codes for Arduino Uno
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../esp01/" class="md-nav__link">
        ESP-01 Subscriber
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#i2c-protocol-for-rpi-b-connection" class="md-nav__link">
    I2C Protocol for RPi B connection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp01-connection" class="md-nav__link">
    ESP01 connection
  </a>
  
    <nav class="md-nav" aria-label="ESP01 connection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-arduino-code" class="md-nav__link">
    The arduino code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#merge-of-both-codes-for-arduino-mega" class="md-nav__link">
    Merge of both codes for Arduino Mega
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#merge-of-both-codes-for-arduino-uno" class="md-nav__link">
    Merge of both codes for Arduino Uno
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="arduino">Arduino</h1>
<p>The arduino is between the RPi, which is connected to the LCD Screen and the ESP01, which is the data consumer in the MQTT system.</p>
<p>At first it will be discussed the I2C protocol implementation with an example. Then, it will be explained different approaches that we tried for the connection between ESP01 and Arduino. </p>
<h2 id="i2c-protocol-for-rpi-b-connection">I2C Protocol for RPi B connection</h2>
<pre><code class="language-c">/*
 * SLAVE CONFIG
 */

#include &quot;Wire.h&quot;

#define SLAVE_ADDR 0x04

uint8_t value1, value2;

void receiveFunc(){
  while(Wire.available()!=2);
    value1=(uint8_t)Wire.read();
    value2=(uint8_t)Wire.read();
    Serial.print(value1);
    Serial.print(&quot;x&quot;);
    Serial.print(value2);
}

void sendFunc(){
   Serial.print(&quot;=&quot;);
   Serial.println((uint8_t)(value1*value2));
   Wire.write((uint8_t)(value1*value2));
}

void setup() {
  // put your setup code here, to run once:
  Serial.begin(9600);
  Wire.begin(SLAVE_ADDR);
  Wire.onReceive(receiveFunc);
  Wire.onRequest(sendFunc);
}

void loop() {
  // put your main code here, to run repeatedly:

}
</code></pre>
<h2 id="esp01-connection">ESP01 connection</h2>
<p>At first we tried to use AT commands, as we thought that it was easier than programming a whole protocol. But, after having some troubles to make the ESP01 work against the firmware, and having already a subscriber for the mqtt broker for the ESP01, we made a simple protocol from reading that corresponds as this:</p>
<pre><code class="language-txt">'0' -&gt; &quot;test&quot;
'1' -&gt; dataproducer1 JSON
'2' -&gt; dataproducer2 JSON
'j' -&gt; all the state as a JSON

</code></pre>
<p>The options '0' and 'j' are meant to be used for debugging, and the options '1' and '2' are meant to be used by the arduino. This messages are terminated with a ';' for reasons discussed later.</p>
<h3 id="the-arduino-code">The arduino code</h3>
<p>The arduino has quite some troubles for parsing the data, as, sometimes, ESP01 adds some noise for the lasts characters. We think that the print library sends the entire size of the array instead of a marked '\0' character array. For this reason, we added a peculiarity: it reads until the character ';', then it discards the rest of the buffer, as the Arduino didn't request for more characters.</p>
<p>The example for this code is:</p>
<pre><code class="language-cpp">#include &lt;ArduinoJson.h&gt;;

char msg[512];
DynamicJsonDocument dataproducer1(256);
DynamicJsonDocument dataproducer2(256);


void setup() {
  // put your setup code here, to run once:
  Serial.begin(115200);
  Serial1.begin(115200);
  delay(100);
  Serial.println(&quot;Start up&quot;);
  while (Serial1.available()&gt;0){}
  Serial1.read();
}

void readDataproducer(DynamicJsonDocument dataproducer) {
  char last_char = 'a';
  while(Serial1.available()&lt;=0){}
  delay(100);
  Serial.println(&quot;Recived a message&quot;);
  int i = 0;
  while(last_char != ';'){
    if (Serial1.available()&gt;0){
      msg[i] = (char)Serial1.read();
      last_char = msg[i];
      i = i + 1;
    }
  }
  msg[i-1] = '\0';
  delay(500);
  deserializeJson(dataproducer, msg);
  Serial.println(&quot;Dataproducer X = &quot;);
  serializeJson(dataproducer, Serial);
  Serial.println();
  char c;
  while(Serial1.available() &gt; 0) { Serial1.readBytes(&amp;c, 1); }
}

void loop() {
  Serial.println(&quot;Stated arduino comunication&quot;);
  //GET DATAPRODUCER1 INFO
  Serial1.write(&quot;1&quot;);
  Serial.println(&quot;Sended request for dataproducer1 info&quot;);
  readDataproducer(dataproducer1);
  //GET DATAPRODUCER2 INFO
  Serial1.write(&quot;2&quot;);
  Serial.println(&quot;Sended request for dataproducer2 info&quot;);
  readDataproducer(dataproducer2);
  delay(2000);

}

</code></pre>
<h2 id="merge-of-both-codes-for-arduino-mega">Merge of both codes for Arduino Mega</h2>
<pre><code class="language-cpp">#include &lt;ArduinoJson.h&gt;;
#include &quot;Wire.h&quot;

const int ARDUINO_ADDR = 0x04;

typedef struct {
  float humidity;
  float temperature;
  float heatIndex;
} dataproducer1;


typedef struct{
  float x;
  float y;
  float z;
} dataproducer2;

dataproducer1 dt1;
dataproducer2 dt2;
bool sendDt1ElseDt2 = true;
char msg[512];
DynamicJsonDocument dataproducerJson1(256);
DynamicJsonDocument dataproducerJson2(256);


void sendRealdt1() {
  Wire.write((byte *) &amp;dt1, 12);
  Serial.println(&quot;Sending dt1...&quot;);
  }

void sendRealdt2() {
  Wire.write((byte *) &amp;dt2, 12);
  Serial.println(&quot;Sending dt2...&quot;);
  }

void sendCharacter() {
  char c = 'a';
  Wire.write((byte *)&amp;c, sizeof(char));
  Serial.println(&quot;Sending dt1...&quot;);
}

void sendCharacters() {
  char c[] = &quot;abcdefghijlmnopqrst&quot;;
  Wire.write((byte *) &amp;c, 12 * sizeof(char));
  Serial.println(&quot;Sending debug&quot;);
}

void senddataproducer() {
  Serial.print(&quot;dataproducer(humidity=&quot;);
  Serial.print(dt1.humidity);
  Serial.print(&quot;, temperature=&quot;);
  Serial.print(dt1.temperature);
  Serial.print(&quot;, heatIndex=&quot;);
  Serial.print(dt1.heatIndex);
  Serial.print(&quot;, x=&quot;);
  Serial.print(dt2.x);
  Serial.print(&quot;, y=&quot;);
  Serial.print(dt2.y);
  Serial.print(&quot;, z=&quot;);
  Serial.print(dt2.z);
  Serial.println(&quot;);&quot;);
  if (sendDt1ElseDt2) {
    sendRealdt1();
  } else {
    sendRealdt2();
  }  
}


void changeState(int numBytes) {
  uint8_t t = Wire.read();
  Serial.print(&quot;msg = &quot;);
  Serial.println(t);
  switch (t) {
    case 0x00:
    sendDt1ElseDt2 = true;
    break;
    case 0x01:
    sendDt1ElseDt2 = false;
  }
}


void setup() {
  // put your setup code here, to run once:
  Serial.begin(115200);
  Serial1.begin(115200);
  Wire.begin(ARDUINO_ADDR);
  Wire.onRequest(senddataproducer);
  Wire.onReceive(changeState);
  delay(100);
  Serial.println(&quot;Start up&quot;);
  while (Serial1.available()&gt;0){}
  Serial1.read();
}

void readDataproducer(DynamicJsonDocument *dataproducer) {
  char last_char = 'a';
  while(Serial1.available()&lt;=0){}
  delay(100);
  Serial.println(&quot;Recived a message&quot;);
  int i = 0;
  while(last_char != ';'){
    if (Serial1.available()&gt;0){
      msg[i] = (char)Serial1.read();
      last_char = msg[i];
      i = i + 1;
    }
  }
  msg[i-1] = '\0';
  delay(500);
  deserializeJson(*dataproducer, msg);
  Serial.println(&quot;Dataproducer X = &quot;);
  serializeJson(*dataproducer, Serial);
  Serial.println();
  char c;
  while(Serial1.available() &gt; 0) { Serial1.readBytes(&amp;c, 1); }
}

void loop() {
  Serial.println(&quot;Stated arduino comunication&quot;);
  //GET dataproducerJson1 INFO
  Serial1.write(&quot;1&quot;);
  Serial.println(&quot;Sended request for dataproducer1 info&quot;);
  readDataproducer(&amp;dataproducerJson1);
  dt1.humidity = dataproducerJson1[&quot;humidity&quot;];
  dt1.temperature = dataproducerJson1[&quot;temperature&quot;];
  dt1.heatIndex = dataproducerJson1[&quot;hic&quot;];
  //GET dataproducerJson2 INFO
  Serial1.write(&quot;2&quot;);
  Serial.println(&quot;Sended request for dataproducer2 info&quot;);
  readDataproducer(&amp;dataproducerJson2);
  dt2.x = dataproducerJson2[&quot;X&quot;];
  dt2.y = dataproducerJson2[&quot;Y&quot;];
  dt2.z = dataproducerJson2[&quot;Z&quot;];
  delay(2000);

}

</code></pre>
<h2 id="merge-of-both-codes-for-arduino-uno">Merge of both codes for Arduino Uno</h2>
<pre><code class="language-cpp">#include &lt;ArduinoJson.h&gt;;
#include &quot;Wire.h&quot;

const int ARDUINO_ADDR = 0x04;

typedef struct {
  float humidity;
  float temperature;
  float heatIndex;
} dataproducer1;


typedef struct{
  float x;
  float y;
  float z;
} dataproducer2;

dataproducer1 dt1;
dataproducer2 dt2;
bool sendDt1ElseDt2 = true;
char msg[512];
DynamicJsonDocument dataproducerJson1(256);
DynamicJsonDocument dataproducerJson2(256);


void sendRealdt1() {
  Wire.write((byte *) &amp;dt1, 12);
  }

void sendRealdt2() {
  Wire.write((byte *) &amp;dt2, 12);
  }

void sendCharacter() {
  char c = 'a';
  Wire.write((byte *)&amp;c, sizeof(char));
}

void sendCharacters() {
  char c[] = &quot;abcdefghijlmnopqrst&quot;;
  Wire.write((byte *) &amp;c, 12 * sizeof(char));
}

void senddataproducer() {
  if (sendDt1ElseDt2) {
    sendRealdt1();
  } else {
    sendRealdt2();
  }  
}


void changeState(int numBytes) {
  uint8_t t = Wire.read();
  switch (t) {
    case 0x00:
    sendDt1ElseDt2 = true;
    break;
    case 0x01:
    sendDt1ElseDt2 = false;
  }
}


void setup() {
  // put your setup code here, to run once:
  Serial.begin(115200);
  Wire.begin(ARDUINO_ADDR);
  Wire.onRequest(senddataproducer);
  Wire.onReceive(changeState);
  delay(100);
  while (Serial.available()&gt;0){}
  Serial.read();
}

void readDataproducer(DynamicJsonDocument *dataproducer) {
  char last_char = 'a';
  while(Serial.available()&lt;=0){}
  delay(100);
  int i = 0;
  while(last_char != ';'){
    if (Serial.available()&gt;0){
      msg[i] = (char)Serial.read();
      last_char = msg[i];
      i = i + 1;
    }
  }
  msg[i-1] = '\0';
  delay(500);
  deserializeJson(*dataproducer, msg);
  char c;
  while(Serial.available() &gt; 0) { Serial.readBytes(&amp;c, 1); }
}

void loop() {
  //GET dataproducerJson1 INFO
  Serial.write(&quot;1&quot;);
  readDataproducer(&amp;dataproducerJson1);
  dt1.humidity = dataproducerJson1[&quot;humidity&quot;];
  dt1.temperature = dataproducerJson1[&quot;temperature&quot;];
  dt1.heatIndex = dataproducerJson1[&quot;hic&quot;];
  //GET dataproducerJson2 INFO
  Serial.write(&quot;2&quot;);
  readDataproducer(&amp;dataproducerJson2);
  dt2.x = dataproducerJson2[&quot;X&quot;];
  dt2.y = dataproducerJson2[&quot;Y&quot;];
  dt2.z = dataproducerJson2[&quot;Z&quot;];
  delay(2000);

}

</code></pre>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../chibios/" class="md-footer__link md-footer__link--prev" aria-label="Previous: ChibiOS" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              ChibiOS
            </div>
          </div>
        </a>
      
      
        
        <a href="../esp01/" class="md-footer__link md-footer__link--next" aria-label="Next: ESP-01 Subscriber" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              ESP-01 Subscriber
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.b1047164.min.js"></script>
      
    
  </body>
</html>